<!DOCTYPE html>
<html>
<head>
  
  <title>CRS.Simple example - Leaflet</title>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.7.5/proj4.js" integrity="sha512-MMmVaQGDVI3Wouc5zT5G7k/snN9gPqquIhZsHgIIHVDlRgYTYGxrwu6w482iIhAq8n5R6+pcBgpGgxFFBz7rZA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4leaflet/1.0.2/proj4leaflet.js" integrity="sha512-NA+0vegFw6AiYXT23H+hk43LxqwpJkkviK/vHTESeu+jUpvWssfQRWWqSR07aUhGSKtfpkdlE8YFrVaHsnb3jw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js" integrity="sha512-Abr21JO2YqcJ03XGZRPuZSWKBhJpUAR6+2wH5zBeO4wAw4oksr8PRdF+BKIRsxvCdq+Mv4670rZ+dLnIyabbGw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
      html, body {
      height: 100%;
      margin: 0;
      }
      #map {
      width: 100%;
      height: 100%;
      }
      </style>

    
</head>
<body>

<div id='map'></div>

<script>

   var fov = 7400 * 1.10055555555555e-05;  // degrees
   var Rearth = 6378137;  // meters
   var pixAngularScale0 = 512 * 180 / (3.14159 * 2 * Rearth); // zoom 0
   var resolution0 = fov/pixAngularScale0; // zoom 0
   var projCenterLat = -36.14292669;
   var projCenterLong = 53.40518235;
   var projCenterX = 3700.5;
   var projCenterY = 3700.5;
   var projString = '+proj=gnom +lat_0=' + projCenterLat + ' +lon_0=' + projCenterLong +' +x_0=' + projCenterY +' +y_0='+projCenterX; //used to be 0,0

   proj4.defs('urn:ogc:def:crs:d4', projString);

// ra, dec are for the upper left corner of image
   var xform = new L.Transformation(-1, -36.10220109, -1, 53.45557429);
//   var xform = new L.Transformation(-1, -36.10220110, -1, 53.35480403);
//   var xform = new L.Transformation(-1, -36.10218458, -1, 53.45560616);

   var crs = new L.Proj.CRS('EPSG:', projString, {
     resolutions: [
       resolution0, resolution0/2, resolution0/4, resolution0/8,
       resolution0/16, resolution0/32, resolution0/64, resolution0/128, resolution0/256
     ],
     transformation: xform
   });

   var map = L.map('map', {
     crs: crs
   }).setView([projCenterLat,projCenterLong], 4);


//>>> print(wcs.pixel_to_world(0.,0.))
//<SkyCoord (ICRS): (ra, dec) in deg
//    (53.45562662, -36.18363115)>
//>>> print(wcs.pixel_to_world(7399.0, 7399.0))
//<SkyCoord (ICRS): (ra, dec) in deg
//    (53.35479041, -36.10220109)>
  var bounds = [[-36.10220109,53.45562662],[-36.18363115,53.35479041]];

  
  
  
  
//  var image = L.imageOverlay('ngc1365_v_v1p2.png', bounds).addTo(map);
  var image = L.imageOverlay('color_ngc1365_uvis_f814w_f555w_f438w_exp_drc_sci.jpg', bounds).addTo(map);

//  var sol = L.latLng([ -36.14292669, 53.40518235 ]);
//  var markerone = L.marker(sol).addTo(map);
//  markerone.bindTooltip("tool tip bound to marker"); 

//below works
//  var polyline = L.polyline([[-36.10220109,53.4556],[-36.18363115,53.35476]]).addTo(map);
//  polyline.bindTooltip("tool tip is bound");

//  map.setView( [3700, 3700], -2);

var myStyleRED   = {"color": "red", "weight": 1, "opacity": 1.0, "fillOpacity": 0.0};  
var myStyleGREEN = {"color": "cyan", "weight": 1, "opacity": 1.0, "fillOpacity": 0.0};    
var myStyleBLUE  = {"color": "blue", "weight": 1, "opacity": 1.0, "fillOpacity": 0.0, "fillColor":"#00000000"};    
  
var urls = [
    'ngc1365_phangshst_associations_v_ws16pc_v1p2.geojson',
    'ngc1365_phangshst_associations_v_ws32pc_v1p2.geojson'
];

//for (var i = 0; i < urls.length; i++) {
//
//    var layers = {};
//
//    $.getJSON(urls[i], function (data) {
//        layers[i] = new L.GeoJSON(data,{ style: myStyleBLUE }).addTo(map);
//    }).done(function () {
//        console.log('$.getJSON Done!');
//    }).fail(function () {
//        console.log('$.getJSON Fail!');
//    });
//}

  var geojsonLayer = new L.GeoJSON.AJAX("ngc1365_phangshst_associations_v_ws64pc_v1p2.geojson", {style: myStyleRED});      
  geojsonLayer.addTo(map);
  var geojsonLayer = new L.GeoJSON.AJAX("ngc1365_phangshst_associations_v_ws32pc_v1p2.geojson", {style: myStyleGREEN});      
  geojsonLayer.addTo(map);
  var geojsonLayer = new L.GeoJSON.AJAX("ngc1365_phangshst_associations_v_ws16pc_v1p2.geojson", {style: myStyleBLUE});      
  geojsonLayer.addTo(map);

  
//FOR CLUSTERS  
var geojsonMarkerOptions = {
    radius: 100,
    fillColor: "#00000000",
    color: "white",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.0
};

var clusters = new L.GeoJSON.AJAX("ngc1365_phangshst_v1p1_candidates_bcw_IR2.geojson", {
    pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng, geojsonMarkerOptions);
    }
});
  clusters.addTo(map);

//SCALE BAR CODE LIFTED FROM LEGACYSURVEY.ORG VIEWER
// A scale bar that shows arcsec / arcmin / degrees rather than meters
var AstroControl = L.Control.Scale.extend({
    options: {
	    imperial: false,
	    maxWidth: 300,
    },
    _updateMetric: function (maxMeters) {
	    // meters -> arcsec
	    var maxArcsec = maxMeters / 30.87;
	    var maxUnit = maxArcsec;
	    var unitName = 'arcsec';

	    if (maxArcsec > 7200) {
	        // degrees
	        maxUnit /= 3600;
	        unitName = 'deg';
	    } else if (maxArcsec >= 180) {
	        // arcmin
	        maxUnit /= 60;
	        unitName = 'arcmin';
	    }
	    var unit = this._getRoundNum(maxUnit);
        var ratio = unit/maxUnit;
		this._mScale.style.width = Math.round(this.options.maxWidth * ratio) + 'px';
	    this._mScale.innerHTML = unit + ' ' + unitName;
    },

    // Yep, astronomers even have different ideas about what numbers are round.
    // _getRoundNum: function (num) {
    // 	var pow10 = Math.pow(10, (Math.floor(num) + '').length - 1),
    // 	d = num / pow10;
    // 	d = d >= 10 ? 10 : d >= 5 ? 5 : d >= 3 ? 3 : d >= 2 ? 2 : 1;
    // 	return pow10 * d;
    // }

});
  
</script>



</body>
</html>
